name: Python 3.14t on windows-11-arm

on: [push]

jobs:
  test-python:
    runs-on: windows-11-arm

    steps:
      - uses: actions/checkout@v6

      - name: Locate or install Python 3.14t
        id: python
        shell: pwsh
        run: |
          $candidates = @(
            "C:\hostedtoolcache\windows\Python\3.14.2\arm64-freethreaded",
            "C:\Python314t"
          )

          foreach ($p in $candidates) {
            if (Test-Path "$p\python.exe") {
              Write-Host "path=$p" >> $env:GITHUB_OUTPUT
              exit 0
            }
          }

          # Not found â€” install manually
          $url  = "https://github.com/actions/python-versions/releases/download/3.14.2-20014991423/python-3.14.2-win32-arm64-freethreaded.zip"
          $zip  = "$env:USERPROFILE\python314t.zip"
          $dest = "C:\Python314t"

          Invoke-WebRequest -Uri $url -OutFile $zip

          choco install 7zip -y
          7z x $zip -o"$dest" -y

          Write-Host "path=$dest" >> $env:GITHUB_OUTPUT

      - name: Add Python 3.14t to PATH (prepend)
        shell: pwsh
        run: |
          $py = "${{ steps.python.outputs.path }}"
          "$py" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8

      - name: Verify Python 3.14t
        shell: pwsh
        run: |
          python --version
          python -c "import sys; print(sys._is_gil_enabled())"

